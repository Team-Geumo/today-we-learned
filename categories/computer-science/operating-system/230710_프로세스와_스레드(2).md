### 프로세스와 스레드

- 프로세스
  
  - 컴퓨터에서 실행되고 있는 프로그램
  
  - 작업과 거의 같은 의미
    
    - 작업 (task)
      
      - CPU 스케줄링의 대상

- 스레드
  
  - 프로세스 내 작업의 흐름

### 프로세스의 메모리 구조

- 스택 (stack)
  
  - 동적 영역
  
  - 지역변수, 매개변수, 함수가 저장됨
  
  - 컴파일 시 크기 결정
  
  - 스택 영역은 함수가 함수를 재귀적으로 호출하면서 동적으로 크기가 늘어날 수 있음
    
    - 이 때 힙과 스택 사이의 공간을 비워놓음
      
      - 힙과 스택의 메모리 영역이 겹치면 안되기 때문

- 힙 (heap)
  
  - 동적 영역
  
  - 런타임 시 크기가 결정됨

- 데이터 영역 (BSS segment, Data segment)
  
  - 정적 영역
  
  - 전역변수, 정적변수가 저장되고 정적인 특징을 갖는 프로그램이 종료되면 사라지는 변수가 들어있는 영역
  
  - 구분
    
    - BSS 영역
      
      - 초기화되지 않은 변수가 0으로 초기화되어 저장
    
    - Data 영역
      
      - 0이 아닌 다른 값으로 할당된 변수 저장

- 코드 영역 (code segment)
  
  - 정적 영역
  
  - 프로그램에 내장되어 있는 소스 코드가 들어가는 영역
  
  - 수정 불가능한 기계어로 저장되어 있음

### PCB

- PCB (Process Control Block)
  
  - 프로세스 제어 블록
  
  - 운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터
    
    - 메타데이터
      
      - 데이터에 관한 구조화된 데이터이자 데이터를 설명하는 작은 데이터
      
      - 대량의 정보 가운데에서 찾고 있는 정보를 효율적으로 찾아내서 이용하기 위해 일정한 규칙에 따라 콘텐츠에 대해 부여되는 데이터
  
  - 프로그램이 실행되면 프로세스가 생성되고 프로세스 주소 값에 메모리 할당
    
    - 메모리 할당은 스택, 힙 등의 구조를 기반으로 함
    
    - 이 프로세스의 메타데이터가 PCB에 저장되어 관리됨
    
    - 프로세스의 중요한 정보를 포함하고 있기 때문에 일반 사용자가 접근하지 못하도록 커널 스택의 가장 앞부분에서 관리

- PCB의 구조
  
  - 프로세스 스케쥴링 상태
    
    - '준비', '일시중단' 프로세스가 CPU에 대한 소유권을 얻은 이후 또는 이후 경과된 시간과 같은 기타 스케쥴링 정보
  
  - 프로세스 ID
    
    - 프로세스 ID, 해당 프로세스의 자식 프로세스 ID
  
  - 프로세스 권한
    
    - 컴퓨터 자원 또는 I/O 디바이스에 대한 권한 정보
  
  - 프로그램 카운터
    
    - 프로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터
  
  - CPU 레지스터
    
    - 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
  
  - CPU 스케쥴링 정보
    
    - CPU 스케쥴러에 의해 중단된 시간 등에 대한 정보
  
  - 계정 정보
    
    - 프로세스 실행에 사용된 CPU 사용량, 실행한 유저의 정보
  
  - I/O 상태 정보
    
    - 프로세스에 할당된 I/O 디바이스 목록

- 컨텍스트 스위칭 (context switching)
  
  - PCB를 교환하는 과정
  
  - 한 프로세스에 할당된 시간이 끝나거나 인터럽트에 의해 발생
  
  - 현대 컴퓨터는 멀티코어의 CPU를 가지지만 컨텍스트 스위칭을 설명할 때는 싱글코어를 기준으로 설명
    
    - 프로세스 A와 B가 있다고 할 때
    
    - 프로세스 A가 실행하다 멈추고 프로세스 A의 PCB를 저장하고 다시 프로세스 B를 로드하여 실행
    
    - 그리고 다시 프로세스 B의 PBC를 저장하고 프로세스 A의 PCB 로드
    
    - 이 때 유휴 시간 (idle time) 발생
  
  - 캐시미스
    
    - 요청된 데이터가 캐시 내에 없는 경우
    
    - 컨텍스트 스위칭이 일어날 때 프로세스가 가지고 있는 메모리 주소가 그대로 있으면 잘못된 주소 변환이 생기므로 캐시 클리어 과정을 겪게 됨 
    
    - 이로 인해 비용이 발생
  
  - 스레드에서의 컨텍스트 스위칭
    
    - 비용이 더 적고 시간도 더 적게 걸림
      
      - 스레드는 스택 영역을 제외한 모든 메모리를 공유하기 때문