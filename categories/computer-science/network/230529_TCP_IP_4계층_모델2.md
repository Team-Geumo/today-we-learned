### TCP/IP 4계층 모델 2

- TCP/IP(Transmission Control Protocol / Internet Protocol)
  
  - 전송 계층
    
    - 송신자와 수신자를 연결하는 통신 서비스를 제공
    
    - 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할
    
    - TCP, UDP 등
      
      - TCP
        
        - 가상회선 패킷 교환 방식 사용
          
          - 가상회선 패킷 교환방식
            
            - 패킷 사이의 순서를 보장하고 연결지향 프로토콜을 사용해 연결하여 신뢰성을 구축해서 수신 여부를 확인
            
            - 각 패킷에는 가상회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식
        
        - TCP 연결 성립 과정
          
          - 신뢰성을 확보할 때 3-way handshake 과정을 거침
            
            - 이 과정이 있기 때문에 TCP를 신뢰성이 있는 계층이라고 하며 UDP는 이 과정이 없기 때문에 신뢰성이 없는 계층
          
          - `3-way handshake`
            
            - SYN 단계
              
              - 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보냄
              
              - ISN (Initial Sequence Numbers)
                
                - 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호
                
                - 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호
                
                - 장치마다 다를 수 있음
              
              - SYN (Synchronization)
                
                - 연결 요청 플래그
            
            - SYN + ACK 단계
              
              - 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN+1을 보냄
            
            - ACK 단계
              
              - 클라이언트는 서버의 ISN+1한 값인 승인번호를 담아 ACK 서버에 보냄
              
              - ACK (Acknowledgement)
                
                - 응답 플래그
        
        - TCP 연결 해제 과정
          
          - `4-way handshake`
            
            - 1
              
              - 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼드를 보내고 FIN_WAIT_1 상태로 들어가고 서버의 응답을 기다림
            
            - 2
              
              - 서버는 클라이언트로 ACK라는 승인 세그먼트를 보내고 CLOSE_WAIT 상태에 들어감
              
              - 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어감
            
            - 3
              
              - 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보냄
            
            - 4
              
              - 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 됨
              
              - 이후 클라이언트는 어느 정도의 시간을 대기한 후 연결이 닫히고 클라이언트와 서버의 모든 자원 연결이 해제
            
            - TIME_WAIT
              
              - 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태
              
              - 연결을 바로 닫지 않고 일정 시간 뒤에 닫는 이유
                
                - 지연 패킷이 발생할 경우를 대비하기 위함
                  
                  - 패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 데이터 무결성 문제가 발생
                    
                    - 데이터 무결성 (data integrity)
                      
                      - 데이터의 정확성과 일관성을 유지하고 보증하는 것
                
                - 두 장치가 연결이 닫혔는지 확인하기 위함
      
      - UDP
        
        - 데이터그램 패킷 교환 방식
          
          - 순서를 보장하지 않고 수신 여부를 확인하지 않으며 단순히 데이터만 줌
          
          - 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가는데, 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있으며 도착한 순서가 다를 수 있음
  
  - 인터넷 계층
    
    - 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
    
    - IP, ARP, ICMP 등
    
    - 패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달
    
    - 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징
