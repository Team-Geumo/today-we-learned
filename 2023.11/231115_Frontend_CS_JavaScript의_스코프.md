# JavaScript의 스코프

자바스크립트는 기본적으로 **함수 레벨 스코프**를 가지고 있으며, ES6부터는 `let`, `const` 키워드가 추가되면서 **블록 레벨 스코프**를 가질 수 있게 되었습니다.

## 1. 스코프(scope)

### 스코프(scope)란?

- 변수 이름, 함수 이름, 클래스 이름과 같은 식별자에 접근할 수 있는 범위
- 식별자가 선언된 위치에 따라 참조될 수 있는 범위가 결정됨

```jsx
function add(x, y) {
  console.log(x, y); // 3 6
  return x + y;
}
add(3, 6);

console.log(x + y); // ReferenceError
```

### 스코프 체인(scope chain)

- 함수는 중첩 될 수 있으며, 이 때 스코프도 함께 중첩 됨
- 아래 코드 예시는 전역(Glbal) > `outer` > `inner` 순서로 스코프가 중첩됨
- 스코프 체인에서 변수를 참조할 때는 하위에서 상위로만 참조 가능함 (반방향성)

```jsx
var x = 'Global x';

function outer() {
  var y = 'Local outer y';
  console.log(x); // Global x
  console.log(y); // Local outer y

  function inner() {
    var x = 'Local inner x';
    console.log(x); // Local inner x
    console.log(y); // Local outer y
  }

  inner();
}

outer();
console.log(x); // Global x
console.log(y); // ReferenceError
```

## 2. 스코프의 분류

### 접근 범위에 따른 분류 : 전역 스코프와 지역 스코프

- **전역 스코프(Global scope)** : 전역에 선언되어 어느 곳에서든 접근할 수 있는 스코프
- **지역 스코프(Local scope)** : 해당 지역에서만 접근할 수 있는 스코프

### 스코프 레벨에 따른 분류 : 블록 레벨 스코프와 함수 레벨 스코프

- **함수 레벨 스코프(Function level scope)**
  - 함수를 기준으로 지역 스코프를 만듦
  - JavaScript는 기본적으로 함수 레벨 스코프를 가짐 (`var`)
- **블록 레벨 스코프(Block level scope)**
  - 함수, if 문, for 문 등의 모든 코드 블록이 지역 스코프를 만듦
  - 대부분의 프로그래밍 언어에서 사용되는 방식
  - JavaScript는 ES6부터 `let`, `const`를 사용해 블록 레벨 스코프를 가질 수 있게 됨

### 상위 스코프가 결정되는 시점에 따른 분류 : 동적 스코프와 정적 스코프

- **동적 스코프(Dynamic scope)**
  - 함수가 호출되는 시점에 상위 스코프가 동적으로 결정
  - 프로그램 런타임 도중 실행 컨텍스트나 호출 컨텍스트에 의해 결정
- **정적 스코프(렉시컬 스코프, Lexical scope)**
  - 함수가 정의되는 시점에 상위 스코프가 정적으로 결정 (바뀌지 않음)
  - 정의된 이후 해당 함수에 의해 함수 객체가 생성되면 **해당 함수 객체는 본인의 상위 스코프를 항상 알 수 있게 됨** (**클로저가 생성될 수 있는 이유)**
  - **JavaScript는 정적 스코프(렉시컬 스코프)를 따르기 때문에** **함수는 태어나면서 자신의 내부 슬롯에 상위 스코프의 참조를 저장함**

### 정적 스코프에 따른 JavaScript 함수 호출 과정

- 자바스크립트 엔진에 의해 진행됨

1. 호출된 함수에 실행 컨텍스트를 생성
   - 실행 컨텍스트 : 실행하고 있는 함수를 트래킹하기 위한 특별한 자료 구조
   - 현재 실행하고 있는 함수 내의 현재 변수 상태와 this의 값을 저장하고 현재 실행 중인 line을 기억하고 있음
2. 실행 컨텍스트 스택에 push
3. 함수는 본인의 렉시컬 환경을 생성
   - 렉시컬 환경 : 실행할 스코프 범위 안에 있는 **변수와 함수를 프로퍼티로 저장하는 객체**
   - 포함하는 식별자, 식별자에 바인딩 된 값, 상위 렉시컬 환경에 대한 참조
4. 코드의 실행이 끝나면 스택에서 해당 컨텍스트를 pop하여 제거
