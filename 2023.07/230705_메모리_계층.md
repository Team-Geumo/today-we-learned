### 메모리 계층

- 메모리 계층
  
  - 레지스터
    
    - CPU 안에 있는 작은 메모리
    
    - 휘발성, 속도가 가장 빠름, 기억 용량이 가장 적음
    
    - 메모리와 CPU 사이의 속도 차이 해결
  
  - 캐시 (cache)
    
    - L1, L2 캐시 지칭
    
    - 휘발성, 속도 빠름, 기억 용량이 적음
    
    - 데이터를 미리 복사해놓는 임시 저장소이자 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리
      
      - 데이터를 접근하는 시간이 오래 걸리는 경우를 해결하고 무언가를 다시 계산하는 시간을 절약할 수 있음
  
  - 메모리 / 주기억장치
    
    - RAM 지칭
    
    - 휘발성, 속도 보통, 기억 용량 보통
    
    - 하드디스크로부터 일정량의 데이터를 복사해서 임시 저장하고 필요 시마다 CPU에 빠르게 전달
  
  - 저장장치 / 보조기억장치
    
    - HDD, SDD 지칭
    
    - 비휘발성, 속도 느림, 기억 용량 많음
  
  - 계층 위로 올라갈수록 가격은 비싸지는데 용량은 작아지고 속도는 빨라짐

- 캐시 직접 설정하기
  
  - 데이터를 기반으로 함
    
    - 지역성
      
      - 데이터의 근거
      
      - 시간 지역성 (temporal locality)
        
        - 최근 사용한 데이터에 다시 접근하려는 특성
          
          ```js
          let arr = Array.from({length : 10}, () => 0);
          console.log(arr)
          // [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          for (let i = 0; i < 10; i += 1) {
              arr[i] = i;
          }
          console.log(arr)
          // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
          ```
          
          - 위의 예시에서 데이터 변수는 i이고 최근에 사용했기 때문에 계속 접근
      
      - 공간 지역성 (spatial locality)
        
        - 최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성
        
        - 위의 예시에서 공간을 나타내는 배열 arr 각 요소에 i가 할당되며 해당 배열에 연속적으로 접근함

- 캐시히트와 캐시미스
  
  - 캐시히트
    
    - 캐시에서 원하는 데이터를 찾은 경우
    
    - 해당 데이터를 제어장치를 거쳐 가져오게 됨
    
    - 위치도 가깝고 CPU 내부 버스를 기반으로 작동하기 때문에 빠름
  
  - 캐시미스
    
    - 원하는 데이터가 캐시에 없는 경우 주메모리로 가서 데이터를 찾아오는 것
    
    - 시스템 버스를 기반으로 작동하기 때문에 느림

- 캐시매핑
  
  - 캐시가 히트되기 위해 매핑하는 방법
    
    - 직접 매핑 (directed mapping)
      
      - 메모리 주소와 캐시의 순서를 일치시켜 매핑
      
      - 처리가 빠르지만 충돌 발생이 잦음
    
    - 연관 매핑 (associative mapping)
      
      - 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑
      
      - 충돌이 적지만 모든 블록을 탐색해야 해서 속도가 느림
    
    - 집합 연관 매핑 (set associative mapping)
      
      - 직접 매핑과 연관 매핑을 합쳐 놓은 것
      
      - 순서는 일치시키지만 집합을 두어 저장
      
      - 블록화되어있어 검색을 더 효율적으로 할 수 있음

- 웹 브라우저의 캐시
  
  - 쿠키
    
    - 만료기한이 있는 키-값 저장소
    
    - same site 옵션을 strict로 설정하지 않았을 경우 다른 도메인에서 요청했을 때 자동 전송
    
    - 4KB까지 데이터를 저장할 수 있고 만료기한을 정할 수 있음
    
    - 쿠키 설정 시 document.cookie로 쿠키를 볼 수 없게 `httponly` 옵션을 거는 것이 중요
    
    - 클라이언트 또는 서버에서 만료기한을 정할 수 있는데 보통 서버에서 정함
  
  - 로컬 스토리지
    
    - 만료기한이 없는 키-값 저장소
    
    - 5MB까지 저장할 수 있으며 웹 브라우저를 닫아도 유지됨
    
    - HTML5를 지원하지 않는 웹브라우저에서는 사용할 수 없음
    
    - 클라이언트에서만 수정 가능
  
  - 세션 스토리지
    
    - 만료기한이 없는 키-값 저장소
    
    - 탭 단위로 세션 스토리지 생성
      
      - 탭을 닫을 때 해당 데이터가 삭제됨
    
    - 5MB까지 저장 가능
    
    - HTML5를 지원하지 않는 웹브라우저에서는 사용할 수 없음
    
    - 클라이언트에서만 수정 가능
